(ns test
  (include base)
  (def has-failed false)

  (defn t* [name test result]
    (when (not (= test result))
      (def has-failed true)
      (prn "❗️ Test failed: `" name
           "` was expected to be " result " but got " test " instead. \n")))

  (defmacro t [name & tests]
    `(do
       (t* ~name ~(first tests) ~(second tests))
       ~(when (rrest tests)
          `(t ~name ~@(rrest tests)))))

  (defn print-done-message []
    (if has-failed
      (prn "❌ Tests completed with some failures. \n")
      (prn "✅ Tests completed without failures. \n")))

  (defmacro st [name & tests]
    ;; st stands for "start-tests"
    `(do
       (prn "ℹ️ Testing `" ~name "`\n")
       ~@tests
       (print-done-message))))